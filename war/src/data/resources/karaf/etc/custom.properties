################################################################################
#
#    Licensed to the Apache Software Foundation (ASF) under one or more
#    contributor license agreements.  See the NOTICE file distributed with
#    this work for additional information regarding copyright ownership.
#    The ASF licenses this file to You under the Apache License, Version 2.0
#    (the "License"); you may not use this file except in compliance with
#    the License.  You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS,
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#    See the License for the specific language governing permissions and
#    limitations under the License.
#
################################################################################
#
# All the values specified here will override the default values given
# in config.properties.
#

${includes} = custom-jahia.system.packages.generated.properties custom-jahia.system.capabilities.generated.properties

# Inherited from Karaf config.properties
org.osgi.framework.system.packages.extra = \
    org.apache.karaf.branding, \
    sun.misc, \
    org.apache.karaf.jaas.boot;uses:=\"javax.security.auth,javax.security.auth.callback,javax.security.auth.login,javax.security.auth.spi,org.osgi.framework\";version=4.3.10, \
    org.apache.karaf.jaas.boot.principal;uses:=javax.security.auth;version=4.3.10, \
    org.apache.karaf.diagnostic.core;uses:=org.osgi.framework;version=4.3.10, \
    org.apache.karaf.diagnostic.core.common;uses:=org.apache.karaf.diagnostic.core;version=4.3.10, \
    ${jahia.system.packages.static}, \
    ${jahia.system.packages.generated}

# Inherited from Karaf config.properties
org.osgi.framework.bootdelegation=\
  com.sun.*, \
  javax.transaction, \
  javax.transaction.*, \
  javax.xml.crypto, \
  javax.xml.crypto.*, \
  jdk.nashorn.*, \
  sun.*, \
  jdk.internal.reflect, \
  jdk.internal.reflect.*, \
  org.apache.karaf.jaas.boot, \
  org.apache.karaf.jaas.boot.principal,\
  ${jahia.bootdelegation}

# Inherited from Karaf config.properties
org.osgi.framework.system.capabilities=\
  ${eecap-${java.specification.version}}, \
  ${${karaf.framework}-capabilities}, \
  ${karaf-capabilities}, \
  ${jahia.system.capabilities.static}, \
  ${jahia.system.capabilities.generated}

#
# Jahia Extra system packages appended after Karaf system packages, this list is static and manually maintained.
# - org.apache.naming.java very old, suspected unused. Originally introduced in Jahia 7.0.0.0 for JNDI lookup from Spring. Class may not even really exist.
# - javax.validation 1.1.0: is here for retro compatibility, Jahia core depends on Hibernate 6.2.5, Jakarta validation-api 2.0.2.
#   Those manual export packages on 1.1.0 seem compatible and allow bundles/modules to continue working properly.
# - javax.websocket 1.1.0: is here because not caught naturally by Jahia framework packages scanner, due to its provided nature.
# - org.joda.time 1.6: is here for retro compatibility, Jahia core was once upgraded to joda 2.
#   Joda 2 exports are correctly handled by jahia system packages, but we decided to keep manual joda 1.6 exports even if Joda 2 is running behind (mostly compatible)
# - Others: are coming from original Karaf org.osgi.framework.system.packages.extra.
#
jahia.system.packages.static=\
    org.apache.naming.java, \
    javax.validation;version=\"1.1.0\", \
    javax.validation.bootstrap;version=\"1.1.0\", \
    javax.validation.constraints;version=\"1.1.0\", \
    javax.validation.constraintvalidation;version=\"1.1.0\", \
    javax.validation.executable;version=\"1.1.0\", \
    javax.validation.groups;version=\"1.1.0\", \
    javax.validation.metadata;version=\"1.1.0\", \
    javax.validation.spi;version=\"1.1.0\", \
    javax.websocket.server;version=\"1.1.0\",\
    javax.websocket;version=\"1.1.0\",\
    org.joda.time;version=\"1.6\",\
    org.joda.time.base;version=\"1.6\",\
    org.joda.time.chrono;version=\"1.6\",\
    org.joda.time.convert;version=\"1.6\",\
    org.joda.time.field;version=\"1.6\",\
    org.joda.time.format;version=\"1.6\"

jahia.bootdelegation=\
  javax.annotation, \
  __redirected, \
  org.apache.tomcat, \
  org.apache.tomcat.util.scan, \
  org.apache.tomcat.util.compat, \
  javax.net.ssl, \
  com.yourkit.*, \
  eu.plumbr.*, \
  eu.plumbr.agent.instrumentation.*, \
  eu.plumbr.agent.*

# Jahia clustering capabilities: when the clustering is activated (cluster.activated=true), the framework is
# providing a special capability for the features to know that the clustering support is activated
jahia-clustering-true=org.jahia.dx.clustering
jahia-clustering-false=
jahia.system.capabilities.static=\
  osgi.service;effective:=active;objectClass=org.osgi.service.packageadmin.PackageAdmin, \
  osgi.service;effective:=active;objectClass=org.osgi.service.resolver.Resolver, \
  osgi.service;effective:=active;objectClass=org.osgi.service.startlevel.StartLevel, \
  osgi.service;effective:=active;objectClass=org.osgi.service.url.URLHandlers, \
  ${jahia-clustering-${cluster.activated}}

#
# You can place any customized configuration here.
#
org.osgi.framework.startlevel.beginning=80
karaf.systemBundlesStartLevel=50
# Disable shutdown port (BACKLOG-6198)
karaf.shutdown.port=-1
# Generated command shutdown
karaf.shutdown.command=ca9b5eb5-0542-4f5d-a3b4-f5a7b451c290
# Share servlet context attributes between bundles and parent container (BACKLOG-6281)
org.apache.felix.http.shared_servlet_context_attributes=true
# Logging related options
org.ops4j.pax.logging.skipJUL=true
karaf.bootstrap.log=${jahia.log.dir}karaf.log
felix.fileinstall.filter=.*\\.(cfg|config|yml|yaml)